<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE module PUBLIC
	"-//Google Inc.//DTD Google Web Toolkit 2.1.0//EN"
	"http://google-web-toolkit.googlecode.com/svn/tags/2.1.0/distro-source/core/src/gwt-module.dtd">

<module rename-to="github_website">
	<inherits name="com.google.gwt.user.User" />
	<inherits name="com.google.gwt.activity.Activity" />
	<inherits name="com.google.gwt.place.Place" />
	<inherits name="com.google.gwt.inject.Inject" />
	<inherits name="com.google.gwt.editor.Editor" />

	<inherits name="com.google.gwt.logging.Logging" />
	<!-- Valid log levels: ALL, SEVERE, WARNING, INFO, FINE, FINER, FINEST -->
	<set-property name="gwt.logging.logLevel" value="ALL" />
	<!-- Change to "FALSE" to remove client-side logging altogether. -->
	<set-property name="gwt.logging.enabled" value="TRUE" />
	<set-property name="gwt.logging.popupHandler" value="DISABLED" />
	<set-property name="gwt.logging.consoleHandler" value="ENABLED" />
	<set-property name="gwt.logging.developmentModeHandler" value="ENABLED" />
	<set-property name="gwt.logging.firebugHandler" value="DISABLED" />
	<set-property name="gwt.logging.systemHandler" value="DISABLED" />

	<inherits name="com.google.gwt.user.theme.standard.Standard" />

	<entry-point class="com.jakewharton.github_website.Main" />

	<source path="github_website" />


	<!-- Define a property to determine if we are mobile or not	-->
	<define-property name="mobile.user.agent" values="mobile, none" />
	<!-- now lets actually do the checking -->
	<property-provider name="mobile.user.agent">
		<![CDATA[
			var ua = navigator.userAgent.toLowerCase();
			
			if (ua.indexOf("webkit") != -1 && ua.indexOf("mobile") != -1) {
				return "mobile";
			}
			
			var isMobile;
			// Look for the m as a url argument
			if (isMobile == null) {
				var args = location.search;
				var startMobile = args.indexOf("m");
				if (startMobile >= 0) {
					var mobile = args.substring(startMobile);
					var begin = mobile.indexOf("=") + 1;
					var end = mobile.indexOf("&");
					if (end == -1) {
						end = mobile.length;
					}
					isMobile = mobile.substring(begin, end);
				}
			}
			
			if (isMobile){
				return "mobile";
			}
			
			return "none";
		]]>
	</property-provider>

	<!--
		Now that we have our property that knows if we are building for
		mobile, we can tell GWT what to do if, in fact, we are building for
		mobile. We are just going to use a different Injector (change the
		wrapper) and it will take care of the rest.
	-->
	<replace-with class="com.jakewharton.github_website.ioc.MobileInjectorWrapper">
		<when-type-is class="com.jakewharton.github_website.ioc.DesktopInjectorWrapper"/>
		<all>
			<when-property-is name="mobile.user.agent" value="mobile"/>
		</all>
	</replace-with>
</module>